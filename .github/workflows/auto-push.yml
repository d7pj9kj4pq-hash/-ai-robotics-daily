name: è‡ªåŠ¨æ¨é€è¾…åŠ©

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["AIæ—¥æŠ¥ç”Ÿæˆ"]
    types:
      - completed

jobs:
  push-if-success:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      with:
        ref: main
        fetch-depth: 0
    
    - name: åŒæ­¥æ›´æ”¹
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        
        # è·å–æœ€æ–°çš„æ›´æ”¹
        git fetch origin
        
        # é‡ç½®åˆ°æœ€æ–°çš„è¿œç¨‹åˆ†æ”¯
        git reset --hard origin/main
        
        # æ·»åŠ æ‰€æœ‰æ›´æ”¹
        git add -A
        
        # å¦‚æœæœ‰æ›´æ”¹å°±æäº¤
        if git diff-index --quiet HEAD --; then
          echo "æ²¡æœ‰æ›´æ”¹å¯æäº¤"
        else
          git commit -m "ğŸ“¦ è‡ªåŠ¨åŒæ­¥: $(date '+%Y-%m-%d %H:%M')"
          git push origin main
        fi
