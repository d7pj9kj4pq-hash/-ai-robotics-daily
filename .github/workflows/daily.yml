name: AIæ—¥æŠ¥ç”Ÿæˆ

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤©åŒ—äº¬æ—¶é—´9ç‚¹
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      with:
        # æ‹‰å–æ‰€æœ‰åˆ†æ”¯å’Œå†å²
        fetch-depth: 0
    
    - name: è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests feedparser pyyaml
    
    - name: åˆ›å»ºå¿…è¦ç›®å½•
      run: |
        mkdir -p output/daily output/weekly output/images docs/daily
    
    - name: è¿è¡Œæ–°é—»æ”¶é›†
      run: python scripts/news_collector.py
    
    - name: è¿è¡ŒAIå¤„ç†
      env:
        ZHIPU_API_KEY: ${{ secrets.ZHIPU_API_KEY }}
      run: python scripts/ai_processor.py
    
    - name: ç”ŸæˆæŠ¥å‘Š
      run: python scripts/report_generator.py
    
    - name: ç”Ÿæˆå›¾ç‰‡
      run: python scripts/image_generator.py || echo "å›¾ç‰‡ç”Ÿæˆè·³è¿‡"
    
    - name: æäº¤æ›´æ”¹
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        # å…ˆæ‹‰å–æœ€æ–°ä»£ç ï¼Œé¿å…å†²çª
        git fetch origin
        
        # æ·»åŠ æ‰€æœ‰æ–‡ä»¶
        git add -A
        
        # æäº¤æ›´æ”¹
        git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°: $(date '+%Y-%m-%d') AIæœºå™¨äººæ—¥æŠ¥" || echo "æ— æ–°å˜åŒ–"
        
        # æ¨é€æ›´æ”¹ï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•å¼ºåˆ¶æ¨é€
        git push origin HEAD:main || git push --force origin HEAD:main
